$(document).ready(function(){(function(a){a(a.ZFM.selectors.elementDraggableContainer).disableSelection();a(a.ZFM.selectors.sortableArea).disableSelection();a(a.ZFM.selectors.trash).disableSelection();a(a.ZFM.selectors.sortableArea).bind("contextmenu",function(a){a.preventDefault()});a.UserInterface={enableDraggable:function(){a(a.ZFM.subSelectors.elementDraggable).draggable({helper:"clone",revert:"invalid",disableSelection:!0,connectToSortable:a(a.ZFM.selectors.sortableArea)}).unbind("dblclick")},
disableDraggable:function(){a(a.ZFM.subSelectors.elementDraggable).draggable("destroy").dblclick(function(){a.ElementManager.createElement(a(this))})},initDraggableCMenu:a(a.ZFM.subSelectors.elementDraggable).contextMenu({menu:a.ZFM.contextMenu.add},function(b,c){switch(b){case "add":a.ElementManager.createElement(c)}}),initSidebar:function(){a(a.ZFM.subSelectors.elementsSwitch).toggle(function(){a(a.ZFM.selectors.elements1).hide("slide",{direction:"left"},500);a(a.ZFM.selectors.elements2).show("slide",
{direction:"right"},500);a(this).html(a.ZFM.images.previousElements)},function(){a(a.ZFM.selectors.elements2).hide("slide",{direction:"right"},500);a(a.ZFM.selectors.elements1).show("slide",{direction:"left"},500);a(this).html(a.ZFM.images.nextElements)});var b=a.ZFM.selectors.elements1+","+a.ZFM.selectors.elements2+","+a.ZFM.selectors.elementDraggableContainer+","+a.ZFM.selectors.showHideElements,c=a(a.ZFM.selectors.elementDraggableContainer).width(),e="OPEN",d="CLOSE",e=e.split("").join("<br/>"),
d=d.split("").join("<br/>");a(a.ZFM.selectors.showHideElements).toggle(function(){a(a.ZFM.selectors.showHideElements).html(a.ZFM.images.openEye+e);a(b).animate({left:"-="+c+"px"},"slow")},function(){a(a.ZFM.selectors.showHideElements).html(a.ZFM.images.closeCross+d);a(b).animate({left:"+="+c+"px"},"slow")}).position({my:"left top",at:"right top",of:a(a.ZFM.selectors.elementDraggableContainer)}).show();a("#sideBarHelp").tooltip()},initFooter:function(){a("#formMakerFooter .cell").mouseenter(function(){a(this).children(".cellRightPart").show()}).mouseleave(function(){a(this).children(".cellRightPart").hide()})},
initTrash:a(a.ZFM.selectors.trash).droppable({accept:"."+a.ZFM.subSelectors.sortableElement,activeClass:a.ZFM.className.sortableActiveClass,drop:function(b,c){a.ElementManager.deleteElement(c.draggable)}}),initSortable:a(a.ZFM.selectors.toggleClassOrdering).parent().parent().toggle(function(){a("."+a.ZFM.className.sortableHandle).show();a.UserInterface.enableSortable();a(a.ZFM.selectors.toggleClassOrdering).text("Lock order");a.UserInterface.enableDraggable()},function(){a("."+a.ZFM.className.sortableHandle).hide();
a.UserInterface.disableSortable();a(a.ZFM.selectors.toggleClassOrdering).text("Unlock order");a.UserInterface.disableDraggable()}),initBuildClass:a("#buildClass").parent().parent().click(function(){a.ajaxCalls.buildForm({formFilename:a.ElementManager.getFormFilename()})}),initFormSettings:a("#formSettingsLink").parent().parent().click(function(){a("#formSettings").dialog("open")}),initReloadForm:a("#reloadForm").parent().parent().click(function(){a.ElementManager.loadForm();a(a.ZFM.selectors.editElementDialogForm).dialog("close");
a("#formSettings").dialog("close");a("#buildInfosDialog").dialog("close")}),initBuildInfoClick:a("#buildInfos").parent().parent().click(function(){a("#buildInfosDialog").dialog("open")}),initPreviewForm:a("#previewForm").parent().parent().click(function(){a.ajaxCalls.previewForm({formFilename:a.ElementManager.getFormFilename()})}),enableSortable:function(){a(a.ZFM.selectors.sortableArea).sortable({revert:!0,handle:"."+a.ZFM.className.sortableHandle,placeholder:a.ZFM.className.sortablePlaceholder,
forcePlaceholderSize:!0,cursor:"move",zIndex:4E3,update:function(){var b=a(a.ZFM.selectors.sortableArea).sortable("serialize"),b={formFilename:a.ElementManager.getFormFilename(),orders:b};a.ajaxCalls.updateOrders(b)},beforeStop:function(b,c){a(c.helper).hasClass("formElement")&&(a.ElementManager.createElement(a(c.helper),"false"),c.item.replaceWith(a.ZFM.tmpSortableElement.el),a.ElementManager.addCMSortableElement(a.ZFM.tmpSortableElement.id),a("."+a.ZFM.className.sortableElement+"_"+a.ZFM.tmpSortableElement.id).effect("highlight"))}})},
disableSortable:function(){a(a.ZFM.selectors.sortableArea).sortable("destroy")},sortSortableCallback:function(){a.Tools.showMessage("success","Element's order saved",50)},buildClassCallback:function(a){if(confirm("Do you want to try your form now ?"))window.location=site.baseUrl+"/Index/form-test/formFilename/"+a.filename},previewFormCallback:function(b){a("#previewFormDialog").html(b);a("#previewFormDialog").dialog("open")},initPreviewFormDialog:a("#previewFormDialog").dialog({autoOpen:!1,resizable:!0,
modal:!1,width:800,height:600}),initFormSettingsDialog:a("#formSettings").dialog({autoOpen:!1,width:600,height:400}),initBuildInfosDialog:a("#buildInfosDialog").dialog({autoOpen:!1,resizable:!0,modal:!1,width:500,height:450}),setWarnings:function(b){if(b instanceof Array)c=b;else{var c=[];c.push(b)}var b=a("#buildInfosDialog"),e;for(e in c){var d=c[e],f;for(f in d){b.append("<h3>"+f+"</h3>");for(var g in d[f]){var h='<div class="line">'+d[f][g].msg+'<br/><a href="#" class="extraDatas">More</a></div><div class="cleaner"></div>';
h+='<div class="more">'+d[f][g].extra+"</div>";b.append(h)}}}a("#buildInfosCounter").text(b.children(".line").length);a("#buildInfosDialog .line .extraDatas").toggle(function(){a(this).text("Less").parent().next().next().fadeIn()},function(){a(this).text("More").parent().next().next().fadeOut()})},eraseBuildInfos:function(){a("#buildInfosDialog").html("")},initDropAreaHelper:a(".imgHelper").tooltip(),initDialog:a(a.ZFM.selectors.editElementDialogForm).dialog({autoOpen:!1,resizable:!0,modal:!1,width:800,
height:570}),initTabs:a(a.ZFM.subSelectors.editElementTabs).tabs({}),initAjaxError:a(a.ZFM.selectors.ajaxError).dialog({autoOpen:!1,width:850,height:600})};a.UserInterface.disableDraggable();a.UserInterface.initFooter();a.UserInterface.initSidebar()})(jQuery)});